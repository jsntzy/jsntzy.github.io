
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>夢見ヶ崎動物公園新聞スペース</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css2.css">
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#ec4899'
                    }
                }
            }
        }
    </script>
    <style>

        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #faf0ff 100%);
            min-height: 100vh;
            background-image:url("img/back.avif");
            background-size:cover;
        }
        .wback{           
        	  background-image:url("img/Daintree.png");
            background-size:cover;}
        .waterfall-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            grid-auto-rows: 10px; /* 关键：设置小的固定行高单位 */
            gap: 20px;
        }
        
        .waterfall-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            break-inside: avoid;
            
        }
        
        .waterfall-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card-image {
            width: 100%;
            padding:5px;
            border-radius: 12px;
            display: block;
            transition: transform 0.5s ease;
        }
        
        .waterfall-card:hover .card-image {
            transform: scale(1.03);
        }
        
        .featured-card {
            background: linear-gradient(135deg, #ffdada 0%, #ffdada 50%);
            color: black;
        }
        
        .featured-card .card-title,
        .featured-card .card-text {
            color: black;
        }
        
        .featured-card .card-meta {
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(99, 102, 241, 0.2);
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
		   .modal-overlay {
		      background-color: rgba(0, 0, 0, 0.3);
		      transition: opacity 0.3s ease;
		      z-index: 9999;
		    }
		    .modal-content {
		      transition: transform 0.3s ease, opacity 0.3s ease;
		    }   
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    .image-preview-container {
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      min-height: 150px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .image-preview-placeholder {
      border: 2px dashed #cbd5e0;
      background-color: #f8fafc;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #718096;
      padding:20px;
      cursor: pointer;      
    }

    .preview-image {
      max-width: 100%;
      max-height: 500px;
      object-fit: contain;
    }
    .hidden-file-input {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 0%;
      height: 0%;
      display:none;
    }		 
    .avatar-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        margin-right: 8px;
        background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
        color: #4f46e5;
    }           
        .icon-1 { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); color: #4f46e5; }
        .icon-2 { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); color: #ec4899; }
        .icon-3 { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #10b981; }
        .icon-4 { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #f59e0b; }
        .icon-5 { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); color: #8b5cf6; } 
        .tooltip {visibility: hidden; width: 120px; background-color: #f1f1f1; color: #333; text-align: center; border-radius: 6px; padding: 5px 0; position: absolute; z-index: 10; top: 125%; /* 修改为在图标下方 */ left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        .tooltip::after {content: ""; position: absolute; top: -5px; /* 修改箭头位置 */ left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: transparent transparent #f1f1f1 transparent; 
        }        
         .icon-container:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }          
    </style>
</head>
<body class="p-4 wback">
    <div class=" mx-auto">
        <!-- 头部 -->
        <header class="text-center mb-12 fade-in pl-8 ">
        	<div class="flex justify-between items-center h-16">
             <div class="flex items-center" style="flex-wrap:wrap">
			            <h1 class="text-xl md:text-2xl text-left font-bold text-white mb-3" style="flex: 1 1 100%;">
			                夢見ヶ崎動物公園新聞スペース
			            </h1>
			            <p class="text-sm text-white max-w-2xl  text-left ">
			                あなたの発見が、みんなのニュースになる。投稿して「名誉レポーター」になってみませんか？
			            </p>
            </div>       	

             <!-- 右侧用户区域 -->
            <div class="flex items-center space-x-4">
                <!-- 用户头像及注册按钮 -->
                <div class="flex items-center space-x-3">                                     
                    <div class="relative icon-container" onclick="popup()">
                        <div  class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600 cursor-pointer hover:scale-110 hover:shadow-lg transition-transform duration-300 flex items-center justify-center text-white font-medium relative">
                            <i class="fas fa-edit"></i>
                        </div>
                        <span class="tooltip">我要发表</span>
                    </div>
                    <div class="relative icon-container">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 cursor-pointer hover:scale-110 hover:shadow-lg transition-transform duration-300 flex items-center justify-center text-white font-medium relative">
                            <i class="fas fa-user"></i>                            
                        </div>
                        <span id="user" class="tooltip">张三</span>
                    </div>                    
                </div>
            </div>      
          </div>     
        </header>
        
        <!-- 瀑布流容器 -->
        <div id="waterfallContainer" class="waterfall-grid">
            <!-- 卡片将通过JavaScript动态生成 -->
        </div>
        
        <!-- 加载指示器 -->
        <div id="loadingIndicator" class="flex justify-center my-12 hidden">
            <div class="loading-spinner"></div>
        </div>
    </div>
    
  <!-- Modal Overlay -->
  <div id="modalOverlay" class="fixed inset-0 flex items-center justify-center hidden modal-overlay">
    <div class="bg-green-50 rounded-xl shadow-2xl w-full max-w-md p-6 modal-content scale-100 opacity-100">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-800"></h2>
        <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 ml-auto">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
		   <form id="submitForm" class="space-y-6"> 
		   	<div id="formContent">
			   </div>   
		      <div class="flex justify-center">
		        <button type="submit" id="submitBtn" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" >
		         ～～～ガチャ～～～
		        </button>
		      </div>
		    </form>
       <div id="result" class="mt-6 hidden p-4 rounded-lg border"></div> 
    </div>
  </div>

      <script src="pubjs.js"></script>
    <script>
        // 卡片数据 - 包含不同长度的内容
        const firstcard = {
                id: 1,
                type: 'image',
                title: '',
                picture: 'https://picsum.photos/400/300?random=1',
                content: '这是第一张特色卡片，内容特别丰富，用于展示Padlet风格的瀑布流布局效果。通过CSS Grid和JavaScript的完美结合，我们可以实现真正根据内容自适应高度的瀑布流布局。\n\n特点包括：\n1. 第一张卡片特殊样式展示\n2. 根据内容自动调整高度\n3. 紧凑无间隙排列\n4. 响应式设计适配各种屏幕\n5. 流畅的动画过渡效果\n\n这种布局方式非常适合内容管理系统、作品展示墙、社交媒体信息流等应用场景。',
                likes: 0,
                comments: 0
            };


       // 加载数据
        async function loadData() {
            // 显示加载状态
            $('#loadingIndicator').removeClass('hidden');       
            try {
                  AllCommData=await getData("getallcomment");
                  
                  var data=await getData("getallrecords");
                    // 显示数据
                    displayData(data);
                  
            } catch (error) {
                console.error('加载数据失败:', error);
            } finally {
                $('#loadingIndicator').addClass('hidden');
            }
        }

       
        // 显示数据
        function displayData(data) {
            if (!data || data.length === 0) {
                return;
            }           
            data.forEach((row, index) => {
								   addNewCard(row)           
            });
        }
  
        // 页面加载完成后初始化
     $(document).ready(function() {
     	     addNewCard(firstcard,1);  //加第一张卡片
     	     loadData();           
     	     $('#closeModalBtn').on('click', function(){hideModal('#modalOverlay')});
     	      $('#closeComment').on('click', function(){hideModal('#modalComment')});
            // 监听窗口大小变化，重新计算高度
            window.addEventListener('resize', function() {
                setTimeout(calculateAndSetCardHeights, 100);
            });
            author=getGuestName("author"); 
            $("#user").html(author);          
    })      
                          
        function popup(){
        	makeform([{type:'image',id:'imageFile',title:'どんなようせいをみつけた？',tip:'写真をアップロード'},
        	{type:'text',id:'commitMessage',title:'ひとことでみなにおしえてね～～～',tip:'ひとことでみなにおしえてね～～～2'}
        	]);
        	$('#submitBtn').html("～～～ガチャ～～～");
        	$('#submitForm').off('submit');
  		    $('#submitForm').on('submit', function(e) {
		        e.preventDefault();
		        var $resultDiv = $('#result');
		        $resultDiv.addClass('hidden');
		
		        const commitMessage = $('#commitMessage').val() || '';
		        const imageFile = $('#imageFile')[0].files[0];		
		        if (!imageFile) {
		          showResult('请选择要上传的图片文件', 'error');
		          return;
		        }
		        if (commitMessage=='') {
		          showResult('写点内容更有意义!', 'error');
		          return;
		        }		        
		         $("#submitBtn").prop('disabled', true);
		         SendData(imageFile,commitMessage);			
		      });       	
        	showModal("#modalOverlay");               	
        }
       function commentCard(_id){   
       	  if(author==''){
       	  	authorWin();
       	  	return;
       	  }   	
        	makeform([{type:'text',id:'commentConent',title:'貴重なコメントをお願いします',tip:'貴重なコメントをお願いします'},
        	{type:'hidden',id:'cardId',value:_id}
        	]);
        	$('#submitBtn').html('コメントの送信');
        	$('#submitForm').off('submit'); 
 	        $('#submitForm').on('submit', function(e) {
		        e.preventDefault();
		        var $resultDiv = $('#result');
		        $resultDiv.addClass('hidden');
		        const _id=$("#cardId").val();
		        const commentConent = $('#commentConent').val() || '';
	          if (commentConent=='') {
		          showResult('评论内容不能为空', 'error');
		          return;
		        }			        
		         $("#submitBtn").prop('disabled', true);
		         PostComment(_id,commentConent);		
		      });       	      	
        	showModal("#modalOverlay"); 
        }       
        function authorWin(){    	
        	makeform([{type:'input',id:'author',title:'请留下你的姓名',tip:'第一次发言，请告诉大家你谁！'}
        	]);
        	$('#submitBtn').html('确定');
        	$('#submitForm').off('submit'); 
 	        $('#submitForm').on('submit', function(e) {
		        e.preventDefault();
		        var $resultDiv = $('#result');
		        $resultDiv.addClass('hidden');
		        author=$("#author").val();	
	          if (author=='') {
		          showResult('姓名不能为空', 'error');
		          return;
		        }		        	        
		         $("#submitBtn").prop('disabled', true);
		        saveGuestName("author", author)	
		        hideModal("#modalOverlay"); 
		        $("#user").html(author);  	
		      });       	      	
        	showModal("#modalOverlay"); 
        }        
    </script>
</body>
</html>
